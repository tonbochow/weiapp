<?php

// +----------------------------------------------------------------------
// | Author: tonbochow
// | date: 2015-02-23
// +----------------------------------------------------------------------

namespace Admin\Controller;

/**
 * 微餐饮公众平台控制器
 */
class MicroPlatformController extends FoodBaseController {

    /**
     * 餐饮管理(后台)
     */
    public function index() {
        $this->display();
    }

    //微餐饮平台列表
    public function lists() {

        $this->display('list');
    }

    //微餐饮公众平台(前台)
    public function food() {
        if (IS_POST) {
//            echo I('post.mp_qrcode');
//            exit;
            $micro_platform_data = I('post.');
            unset($micro_platform_data['wx_pay_arr']);
            unset($micro_platform_data['is_chain_arr']);
            $save_path = C('WEBSITE_URL') . '/Uploads/Mp/' . $micro_platform_data['id'] . '/info/';
            if (!file_exists($save_path)) {
                $mkdir_res = mkdir($save_path, 0777, true);
                if (!$mkdir_res) {
                    $this->error('创建上传图片目录失败','',true);
                }
            }
            if (!empty($micro_platform_data['mp_qrcode'])) {//生成微信公众平台二维码图片
                $mp_qrcode_path = $save_path . C('MP_QRCODE_UPLOAD')['saveName'] . '.jpg';
//                $a = 'data:image/jpeg;base64,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nU00AJSUtJTASkpTSUxCUlLRQI5uilorcgKKKKACiiloASloooAKKKKACilooAKKKKACiilpAFFFFABS0lLQAUUUUAFLRRQAUUUtACUtFFABS0UUAFLSUtAC0UlLSAWjFFLQMSloFLQAlFLilxQAlFLiigAooxS0AJS0UtABRRS0gCilooAKMUtFACUtLijFACUUuKXFACUUuKMUwEpcUuKMUAJS0uKMUgExS4paKAJBkgAE/jUjgKuCct/KoQxHQ1PEob5n61LLQz5xgZIoKcnA/GpWiUnIY4oQHdgD9aLhYbFlWOePerqMuBkg1UYMxJI2getP3KQMtyKlq5S0LTMg5zimiVD04z0qsdoOc7vYUhf0XFTyjuWgO5NIRu5zUKSueDUyNhenNJoaY5EPXNPKcUKfUjNPXmpGRLHmniPFLnHWjdnpmkAhXFG3PalyO5pAwoATZSFKk3Cm+YuaAGbBmlAFKXX1pPNQUwFFOApFkVumKdkUAGKWkzS0AIyj0qN1GKkNMb0poRFgig9OTSsD6ik2n0qyRySEHBORUvmI3Wq+KKVguWNyZ4pS8anmq3NFHKO5ZDxntQWXtVfmgUcoXJvNwDimea1JkelA29waLBclWU9DT+vUVACAelBYmlYLkjBc8H8qaVAPWmUU7BcXaTSheMmgGgsTQApAUU2g80UxBRS0UAFKKKUYpDHKmRmjac4pATSg85pABUilLnbigsSMU2gByY704MPQVHRQA4uR0obkA0gGaAxFAxpPakwTSnmimITFGKWigACZpwUDvmmg0o4NJgLg54HFNPFOZyRTaaASilxRQAhGKSnGkoEBpKWimAlFLRQAdqSlpKAEppp1IaYhtFLRigBMUUtFACUUtFACYopaKAEoxS4o4oATFGKWjNACYNNpxJpKAEopaMUCExRilxS4oGJijFLilxSASilooASilopANpaWigYlGKWigBMUUtJQAlFFFAhDSUtJTASkpaTFACUlOxQVIoEMop+2jAB55ouOxzFFFFdBkFLRRQAUUUUAFFLRQAUUUUAFFLRQAUUUUgCiiloASloooAKKKWgAooooAKKWigAoopaAEpaKKACloooAKWiigYUUtFAgpaSlpDCiiloAKUUlLQAtLSUUgFxRiiloGGKKWloAbS0uKMUAFFLijFACUtFLQAUUtFABRS0UAFGKWigBMUuKXFFIBMUYp2KMUAJiinYoxQAgGTT8npmkFGKAFXk8nFSxqUO88kdBiohxTg7A9aTGhzSuw56UwUpOe1AoAfECTipGRIuCSx9qjjIDZJxSyPlsqTS6j6Clt2ByKfuXOOfrUSnB5qQN34pNDTJIuCWw';
                $mp_qrcode_tmp = base64_decode($micro_platform_data['mp_qrcode']);
                $create_mp_qrcode = file_put_contents($mp_qrcode_path, $mp_qrcode_tmp);
                dump($micro_platform_data['mp_qrcode']);
                exit;
                if ($create_mp_qrcode == false) {
                    $this->error('生成微信公众平台二维码图片失败!', '', true);
                }
            }
            if (!empty($micro_platform_data['mp_img'])) {//生成微信工作平台头像图片
                $mp_img_path = $save_path . C('MP_IMG_UPLOAD')['saveName'] . '.jpg';
                $mp_img_tmp = base64_decode($micro_platform_data['mp_img']);
                $create_mp_img = file_put_contents($mp_img_path, $mp_img_tmp);
                if ($create_mp_img == false) {
//                    @unlink($mp_qrcode_path);
                    $this->error('生成微信公众平台头像图片失败!', '', true);
                }
            }
            $microPlatformModel = D('MicroPlatform');
            if ($microPlatformModel->create($micro_platform_data)) {
                $platform_save = $microPlatformModel->save($micro_platform_data);
                if ($platform_save == false) {
                    $this->error('更新微信工作平台信息失败!', '', true);
                }
            } else {
                $this->error('更新微信工作平台信息失败!', '', true);
            }
            $this->success('更新成功!请登录微信公众平台进行绑定!', '', true);
        }
        $microPlatformModel = M('MicroPlatform');
        $micro_platform = $microPlatformModel->where(array('member_id' => UID, 'app_type' => \Admin\Model\MicroPlatformModel::$APP_TYPE_FOOD))->find();
        $mp_wxpay = \Admin\Model\MicroPlatformModel::getMpWxPay(null, false);
        foreach ($mp_wxpay as $id => $val) {
            $mp_wxpay_arr[] = array('id' => $id, 'wx_pay' => $val);
        }
        $this->assign('mp_wxpay_arr', json_encode($mp_wxpay_arr));
        $this->assign('selected_wx_pay', $micro_platform['support_wxpay']);
        $is_chain = \Admin\Model\MicroPlatformModel::getMpChain(null, false);
        foreach ($is_chain as $id => $val) {
            $is_chain_arr[] = array('id' => $id, 'is_chain' => $val);
        }
        $this->assign('is_chain_arr', json_encode($is_chain_arr));
        $this->assign('selected_is_chain', $micro_platform['is_chain']);
        $this->assign('micro_platform', $micro_platform);
        $this->assign('json_micro_platform', json_encode($micro_platform));
        $this->meta_title = '微餐饮公众平台';
        $this->display('food');
    }

}
