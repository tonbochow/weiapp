<extend name="Base/common"/>
<block name="style">
    <style type="text/css">

    </style>
</block>
<block name="header">

</block>

<block name="body">
    <div class="row" style="margin-top:10px;">

        <if condition="$food_cates neq ''">
            <form  novalidate  class="form-horizontal" class="ng-app:weiapp_food_cate" ng-app="weiapp_food_cate" id="ng-app"  name="FoodCateForm" ng-controller="FoodCateController" ng-submit="submitForm()">
                <div class="col-xs-12">
                    <div class="form-item" ng-class="{'has-error' : FoodCateForm.dining_room_id.$invalid && !FoodCateForm.dining_room_id.$pristine}">
                        <label class="item-label">所属餐厅<span class="check-tips">（*必须）</span></label>
                        <div class="controls">
                            <select class="form-control" name="dining_room_id" required ng-model="food_cate.dining_room_id" ng-options="m.id as m.dining_name for m in food_cate.dining_room_arr">
                                <option value="">请选择</option>
                            </select>
                            <p ng-show="FoodCateForm.dining_room_id.$invalid && !FoodCateForm.dining_room_id.$pristine" class="help-block">请选择所属餐厅</p>
                        </div>
                    </div>

                    <ul class="list-group">
                        <volist name="food_cates" id="cate">
                            <a href="/Wechat/index/index/t/{$mp.mp_token}/cate_id/{$cate.id}">
                                <li class="list-group-item">
                                    <i class="fa fa-circle" style="color:red"></i>
                                    <span class="badge" style="background:pink">
                                        <?php echo \Admin\Model\FoodModel::getFoodsCount($mp['id'],$cate['id'],$cate['dining_room_id']);?>
                                        <i class="fa fa-chevron-right"></i>
                                    </span>
                                    {$cate.cate_name}
                                </li>
                            </a>
                        </volist>
                    </ul>
                </div>
            </form>
            <else />
            <div class="col-xs-12" style="text-align:center;">本店未设置菜品分类</div>
        </if>

    </div>
</block>

<block name="script">
    <script type="text/javascript">
        var FoodCateModule = angular.module("weiapp_food_cate", []);
        FoodCateModule.controller("FoodCateController", function($scope, $http) {
            $scope.food_cate = {};
            $scope.food_cate.dining_room_arr = {$dining_room_arr};
            $scope.food_cate.dining_room_id = {$selected_dining_room_id};
            $scope.submitForm = function() {
                $('.submit').attr('disabled', 'true');
                $http({
                    method: "POST",
                    url: "/Wechat/FoodCate/add",
                    data: $.param($scope.food_cate),
                    headers: {'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'}
                }).success(function(data) {
                    if (data.status) {
                        $('#dialog_content').text(data.info);
                        $("#dialog").dialog({modal: true});
                        setTimeout("result(" + data.status + ")", 1000);
                    } else {
                        $('#dialog_content').text(data.info);
                        $("#dialog").dialog({modal: true});
                        setTimeout("result(" + data.status + ")", 1000);
                    }
                });
            };
        });
    </script>
</block>
